<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informations & Agenda | Patro du Val d'Haine</title>
    
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Bibliothèque pour convertir le Markdown des valves en HTML -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="layout.js"></script>

    <script>
        tailwind.config = { theme: { extend: { colors: { patro: { yellow: '#FFD700', green: '#009045', dark: '#1a1a1a', light: '#f8fafc' } }, fontFamily: { sans: ['Poppins', 'sans-serif'], display: ['Fredoka', 'sans-serif'] } } } }
    </script>
</head>
<body class="font-sans text-slate-800 bg-patro-light antialiased">

    <div id="custom-cursor"></div>
    <div id="loader"><div class="spinner mb-4"></div><p class="text-patro-green font-bold font-display animate-pulse">Chargement...</p></div>
    <div id="navbar-placeholder"></div>

    <!-- En-tête -->
    <div class="pt-32 pb-12 bg-patro-green text-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-10" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
        <h1 class="text-4xl font-display font-bold text-white relative z-10">Valves & Agenda</h1>
        <p class="text-green-100 mt-2 relative z-10">Toutes les dernières nouvelles du Patro en direct.</p>
    </div>

    <section class="py-16 px-4">
        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-12">
            
            <!-- COLONNE GAUCHE : CALENDRIER -->
            <div class="lg:col-span-1 space-y-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="p-3 bg-patro-yellow rounded-xl shadow-sm text-patro-dark">
                        <i data-lucide="calendar-days" class="w-6 h-6"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 font-display">Prochaines Dates</h2>
                </div>

                <!-- Container Calendrier -->
                <div id="calendar-container" class="space-y-4">
                    <!-- Chargement -->
                    <div class="animate-pulse flex space-x-4 bg-white p-4 rounded-xl">
                        <div class="rounded-full bg-gray-200 h-10 w-10"></div>
                        <div class="flex-1 space-y-2 py-1">
                            <div class="h-2 bg-gray-200 rounded"></div>
                            <div class="h-2 bg-gray-200 rounded w-3/4"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COLONNE DROITE : VALVES INFO -->
            <div class="lg:col-span-2">
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-3 bg-patro-green rounded-xl shadow-sm text-white">
                        <i data-lucide="bell" class="w-6 h-6"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 font-display">Aux Valves</h2>
                </div>

                <!-- Container Valves (Style papier/post-it) -->
                <div class="bg-white p-8 rounded-3xl shadow-lg border border-gray-100 relative overflow-hidden min-h-[400px]">
                    <!-- Effet punaise -->
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <i data-lucide="pin" class="w-12 h-12 text-patro-dark transform rotate-45"></i>
                    </div>

                    <div id="valves-content" class="prose prose-green max-w-none">
                        <!-- Le contenu Markdown sera injecté ici -->
                        <div class="flex flex-col items-center justify-center h-64 text-gray-400">
                            <div class="spinner mb-4 border-gray-300 border-t-patro-green"></div>
                            <p>Récupération des dernières infos...</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <div id="footer-placeholder"></div>

    <!-- SCRIPT MAGIQUE -->
    <script>
        // Configuration GitHub
        const repoOwner = 'staffpatrovdh-pixel'; 
        const repoName = 'staffpatrovdh-pixel.github.io';
        const branch = 'main'; // Ou 'master' selon votre config
        
        // URLs des fichiers bruts (Raw)
        // On ajoute un timestamp ?t=... pour éviter que le navigateur ne garde une vieille version en cache
        const calendarUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/donnees-site/calendrier.txt?t=${Date.now()}`;
        const valvesUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/donnees-site/valves.md?t=${Date.now()}`;

        document.addEventListener('DOMContentLoaded', () => {
            loadCalendar();
            loadValves();
        });

        // 1. CHARGEMENT DU CALENDRIER
        async function loadCalendar() {
            try {
                const response = await fetch(calendarUrl);
                if (!response.ok) throw new Error("Fichier calendrier introuvable");
                const text = await response.text();
                
                const container = document.getElementById('calendar-container');
                container.innerHTML = ''; // Vider le loader

                const lines = text.split('\n');
                let hasEvents = false;

                lines.forEach(line => {
                    // Ignorer les lignes vides
                    if (!line.trim()) return;

                    // Format attendu : Date | Titre | Lieu
                    const parts = line.split('|');
                    if (parts.length >= 2) {
                        hasEvents = true;
                        const date = parts[0].trim();
                        const title = parts[1].trim();
                        const place = parts[2] ? parts[2].trim() : '';

                        // Création HTML de la carte événement
                        const html = `
                            <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-patro-yellow hover:shadow-md transition flex items-start gap-4">
                                <div class="flex-shrink-0 bg-gray-50 rounded-lg p-2 text-center min-w-[60px]">
                                    <span class="block text-xs text-gray-500 font-bold uppercase">${date.split('/')[1] || ''}</span> <!-- Mois -->
                                    <span class="block text-xl font-bold text-patro-dark">${date.split('/')[0]}</span> <!-- Jour -->
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800 text-lg">${title}</h3>
                                    ${place ? `<p class="text-sm text-gray-500 flex items-center gap-1 mt-1"><i data-lucide="map-pin" class="w-3 h-3"></i> ${place}</p>` : ''}
                                </div>
                            </div>
                        `;
                        container.innerHTML += html;
                    }
                });

                if (!hasEvents) {
                    container.innerHTML = '<p class="text-gray-500 italic">Aucune date prévue pour le moment.</p>';
                }
                
                if(typeof lucide !== 'undefined') lucide.createIcons();

            } catch (error) {
                console.error(error);
                document.getElementById('calendar-container').innerHTML = 
                    '<div class="bg-red-50 text-red-500 p-4 rounded-lg text-sm">Impossible de charger le calendrier.</div>';
            }
        }

        // 2. CHARGEMENT DES VALVES (MARKDOWN)
        async function loadValves() {
            try {
                const response = await fetch(valvesUrl);
                if (!response.ok) throw new Error("Fichier valves introuvable");
                const markdownText = await response.text();
                
                const container = document.getElementById('valves-content');
                
                // Conversion Markdown -> HTML via la librairie 'marked'
                // On configure pour que les sauts de ligne soient respectés
                marked.setOptions({ breaks: true });
                container.innerHTML = marked.parse(markdownText);

            } catch (error) {
                console.error(error);
                document.getElementById('valves-content').innerHTML = 
                    '<div class="bg-red-50 text-red-500 p-4 rounded-lg text-center">Impossible de charger les informations.</div>';
            }
        }
    </script>

    <!-- Styles spécifiques pour le contenu Markdown (Prose) -->
    <style>
        .prose h1 { font-family: 'Fredoka', sans-serif; color: var(--patro-green); font-size: 1.8em; margin-bottom: 0.5em; margin-top: 1em; }
        .prose h1:first-child { margin-top: 0; }
        .prose h2 { font-family: 'Fredoka', sans-serif; color: var(--patro-dark); font-size: 1.4em; margin-top: 1em; margin-bottom: 0.5em; }
        .prose p { margin-bottom: 1em; color: #4b5563; line-height: 1.6; }
        .prose strong { color: var(--patro-dark); font-weight: 700; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; color: #4b5563; }
        .prose li { margin-bottom: 0.3em; }
        .prose blockquote { border-left: 4px solid var(--patro-yellow); padding-left: 1em; font-style: italic; background: #fffbeb; padding: 1em; border-radius: 0 8px 8px 0; }
    </style>
</body>
</html>
